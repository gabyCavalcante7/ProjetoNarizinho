<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Gestão de Lotes</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            slate: {
              50: '#f8fafc',
              100: '#f1f5f9',
              200: '#e2e8f0',
              300: '#cbd5e1',
              400: '#94a3b8',
              500: '#64748b',
              600: '#475569',
              700: '#334155',
              800: '#1e293b',
              900: '#0f172a',
            }
          }
        }
      }
    }
  </script>
  <style>
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 p-4 md:p-6">
  <!-- Estado global simulado -->
  <script>
    // Simular usuário e dados
    let currentUser = { name: "Gabrielly Souza", id: "OP007", role: "user" }; // ou "admin"
    let lotes = [
      { id: "L001", produto: "Camisa Polo", quantidade: 120, data: "2025-10-05", status: "Pendente" },
      { id: "L002", produto: "Calça Jeans", quantidade: 80, data: "2025-10-06", status: "Em Conferência" },
      { id: "L003", produto: "Vestido Floral", quantidade: 50, data: "2025-10-07", status: "Conferida" },
      { id: "L004", produto: "Camiseta Básica", quantidade: 200, data: "2025-10-08", status: "Pendente" },
    ];
    let conferencias = [];
    let selectedLote = null;
    let checklist = [
      { key: "costura", label: "Costura ok", ok: false },
      { key: "acabamento", label: "Acabamento ok", ok: false },
      { key: "etiqueta", label: "Etiqueta correta", ok: false },
      { key: "tamanho", label: "Numeração correta", ok: false },
    ];
    let defeito = "";
    let fotoUrl = null;
    let startTime = null;

    const DEFAULT_CHECKLIST = checklist.map(c => ({ ...c }));

    function toggleRole() {
      currentUser.role = currentUser.role === "user" ? "admin" : "user";
      render();
    }

    function openConferir(lote) {
      selectedLote = lote;
      checklist = DEFAULT_CHECKLIST.map(c => ({ ...c, ok: false }));
      defeito = "";
      fotoUrl = null;
      startTime = Date.now();
      render();
    }

    function closeConferencia() {
      selectedLote = null;
      render();
    }

    function toggleChecklist(key) {
      checklist = checklist.map(item => 
        item.key === key ? { ...item, ok: !item.ok } : item
      );
      render();
    }

    function handleDefeito(e) {
      defeito = e.target.value;
    }

    function handleFoto(e) {
      const file = e.target.files?.[0];
      if (file) {
        const url = URL.createObjectURL(file);
        fotoUrl = url;
        render();
      }
    }

    function salvarConferencia(aprovada) {
      if (!selectedLote) return;

      const timeSpentMs = Date.now() - startTime;
      const novaConferencia = {
        id: `C${String(conferencias.length + 1).padStart(3, "0")}`,
        loteId: selectedLote.id,
        produto: selectedLote.produto,
        conferente: currentUser.name,
        userId: currentUser.id,
        data: new Date().toISOString(),
        aprovacao: aprovada ? "Aprovada" : "Reprovada",
        checklist: [...checklist],
        defeito: defeito || null,
        foto: fotoUrl,
        timeSpentMs
      };

      conferencias.unshift(novaConferencia);

      // Atualiza status do lote
      lotes = lotes.map(l => 
        l.id === selectedLote.id 
          ? { ...l, status: aprovada ? "Conferida" : "Reprovada" } 
          : l
      );

      selectedLote = null;
      render();
    }

    function addNewLote() {
      const novo = {
        id: `L${String(lotes.length + 1).padStart(3, '0')}`,
        produto: "Produto Novo",
        quantidade: 30,
        data: new Date().toISOString().slice(0,10),
        status: "Pendente"
      };
      lotes.unshift(novo);
      render();
    }

    function clearHistory() {
      conferencias = [];
      render();
    }

    function filterLotes(q = "", status = "Todos", date = "") {
      return lotes.filter(l => {
        if (status !== "Todos" && l.status !== status) return false;
        if (date && l.data !== date) return false;
        if (q && !(l.id.toLowerCase().includes(q.toLowerCase()) || l.produto.toLowerCase().includes(q.toLowerCase()))) return false;
        return true;
      });
    }

    function getStats() {
      const total = conferencias.length;
      const aprovadas = conferencias.filter(c => c.aprovacao === "Aprovada").length;
      const reprovadas = total - aprovadas;
      const avgTimeSec = total ? Math.round(conferencias.reduce((s, c) => s + c.timeSpentMs, 0) / total / 1000) : 0;
      return { total, aprovadas, reprovadas, avgTimeSec };
    }

    // Filtros
    let filters = { q: "", status: "Todos", date: "" };

    function updateFilter(key, value) {
      filters[key] = value;
      render();
    }

    // Renderização manual (simples)
    function render() {
      document.getElementById('app').innerHTML = App();
    }

    function App() {
      const filtered = filterLotes(filters.q, filters.status, filters.date);
      const stats = getStats();

      return `
        <!-- Cabeçalho -->
        <header class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-indigo-600 to-purple-500 flex items-center justify-center text-white font-bold">FG</div>
            <div>
              <h1 class="text-2xl font-semibold">Sistema de Conferência Final</h1>
              <p class="text-sm text-slate-600">Rastreabilidade, qualidade e rapidez na conferência de roupas</p>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <div class="text-right">
              <div class="text-sm text-slate-500">Operador</div>
              <div class="font-medium">${currentUser.name} <span class="text-xs text-slate-400">(${currentUser.id})</span></div>
              <div class="text-xs text-slate-500 mt-1">${currentUser.role === 'admin' ? 'Administrador' : 'Usuário Comum'}</div>
            </div>
            <button onclick="toggleRole()" class="px-3 py-2 bg-white border rounded-md shadow-sm text-sm">
              ${currentUser.role === 'admin' ? 'Modo Usuário' : 'Modo Admin'}
            </button>
            <button class="px-3 py-2 bg-white border rounded-md shadow-sm text-sm">Sair</button>
          </div>
        </header>

        <!-- Conteúdo principal -->
        <main class="grid grid-cols-1 lg:grid-cols-12 gap-6">
          <!-- Lista de Lotes -->
          <section class="lg:col-span-7 bg-white rounded-2xl p-4 shadow-sm">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold">Lotes produzidos</h2>
              <div class="text-sm text-slate-500">Filtros rápidos</div>
            </div>
            <div class="flex flex-col sm:flex-row gap-2 items-center mb-4">
              <input type="text" placeholder="Pesquisar lote ou produto" value="${filters.q}" oninput="updateFilter('q', this.value)" class="flex-1 px-3 py-2 border rounded-md" />
              <select onchange="updateFilter('status', this.value)" class="px-3 py-2 border rounded-md">
                <option ${filters.status === 'Todos' ? 'selected' : ''}>Todos</option>
                <option ${filters.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                <option ${filters.status === 'Em Conferência' ? 'selected' : ''}>Em Conferência</option>
                <option ${filters.status === 'Conferida' ? 'selected' : ''}>Conferida</option>
                <option ${filters.status === 'Reprovada' ? 'selected' : ''}>Reprovada</option>
              </select>
              <input type="date" value="${filters.date}" onchange="updateFilter('date', this.value)" class="px-3 py-2 border rounded-md" />
            </div>

            <div class="divide-y">
              ${filtered.length === 0 ? 
                `<div class="p-6 text-center text-slate-500">Nenhum lote encontrado.</div>` :
                filtered.map(lote => `
                  <div class="p-4 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                    <div class="flex items-center gap-3">
                      <div class="w-12 h-12 rounded-md bg-slate-100 flex items-center justify-center font-medium">${lote.id}</div>
                      <div>
                        <div class="font-medium">${lote.produto}</div>
                        <div class="text-sm text-slate-500">Qtd: ${lote.quantidade} · Data: ${lote.data}</div>
                      </div>
                    </div>
                    <div class="flex items-center gap-3">
                      <span class="px-3 py-1 rounded-full text-sm ${
                        lote.status === 'Conferida' ? 'bg-green-100 text-green-800' :
                        lote.status === 'Reprovada' ? 'bg-rose-100 text-rose-800' :
                        lote.status === 'Em Conferência' ? 'bg-amber-100 text-amber-800' :
                        'bg-slate-100 text-slate-700'
                      }">${lote.status}</span>
                      <button onclick="openConferir(${JSON.stringify(lote).replace(/"/g, '&quot;')})" class="px-3 py-2 bg-indigo-600 text-white rounded-md shadow-sm text-sm">Conferir</button>
                    </div>
                  </div>
                `).join('')
              }
            </div>

            ${currentUser.role === 'admin' ? `
              <div class="mt-4 flex justify-end">
                <button onclick="addNewLote()" class="px-4 py-2 bg-green-600 text-white rounded-md">+ Novo Lote</button>
              </div>
            ` : ''}
          </section>

          <!-- Painel lateral -->
          <aside class="lg:col-span-5 space-y-4">
            <!-- Estatísticas -->
            <div class="bg-white rounded-2xl p-4 shadow-sm">
              <h3 class="font-semibold">Painel Rápido</h3>
              <div class="mt-3 grid grid-cols-2 gap-3">
                <div class="p-3 border rounded-lg">
                  <div class="text-xs text-slate-500">Total conferências</div>
                  <div class="text-2xl font-bold">${stats.total}</div>
                </div>
                <div class="p-3 border rounded-lg">
                  <div class="text-xs text-slate-500">Aprovadas</div>
                  <div class="text-2xl font-bold text-green-600">${stats.aprovadas}</div>
                </div>
                <div class="p-3 border rounded-lg">
                  <div class="text-xs text-slate-500">Reprovadas</div>
                  <div class="text-2xl font-bold text-rose-600">${stats.reprovadas}</div>
                </div>
                <div class="p-3 border rounded-lg">
                  <div class="text-xs text-slate-500">Tempo médio (s)</div>
                  <div class="text-2xl font-bold">${stats.avgTimeSec}</div>
                </div>
              </div>
            </div>

            <!-- Histórico -->
            <div class="bg-white rounded-2xl p-4 shadow-sm">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Histórico (últimas conferências)</h3>
                <button onclick="clearHistory()" class="text-sm text-slate-500">Limpar</button>
              </div>
              <div class="mt-3 divide-y max-h-72 overflow-auto">
                ${conferencias.length === 0 ? 
                  `<div class="p-4 text-slate-500">Nenhuma conferência registrada.</div>` :
                  conferencias.map(c => `
                    <div class="p-3 flex flex-col sm:flex-row items-start gap-3">
                      <div class="w-10 h-10 rounded-md bg-slate-100 flex items-center justify-center text-sm font-medium">${c.loteId}</div>
                      <div class="flex-1">
                        <div class="flex items-center justify-between">
                          <div class="text-sm font-medium">${c.produto} <span class="text-xs text-slate-400">· ${new Date(c.data).toLocaleString()}</span></div>
                          <div class="${c.aprovacao === 'Aprovada' ? 'text-green-600' : 'text-rose-600'} text-sm">${c.aprovacao}</div>
                        </div>
                        <div class="text-xs text-slate-500">Por: ${c.conferente} · Tempo: ${Math.round(c.timeSpentMs/1000)}s</div>
                        ${c.defeito ? `<div class="mt-2 text-xs text-rose-700">Defeito: ${c.defeito}</div>` : ''}
                        ${c.foto ? `<img src="${c.foto}" alt="evidência" class="mt-2 w-28 h-20 object-cover rounded-md border">` : ''}
                      </div>
                    </div>
                  `).join('')
                }
              </div>
            </div>

            <!-- Ações do Gestor (só admin) -->
            ${currentUser.role === 'admin' ? `
              <div class="bg-white rounded-2xl p-4 shadow-sm">
                <h3 class="font-semibold">Ações do Gestor</h3>
                <div class="mt-3 flex gap-2">
                  <button onclick="alert('Exportar CSV (simulado)')" class="px-3 py-2 border rounded-md text-sm">Exportar CSV</button>
                  <button onclick="alert('Abrir relatório completo (simulado)')" class="px-3 py-2 border rounded-md text-sm">Relatório</button>
                </div>
              </div>
            ` : ''}
          </aside>
        </main>

        <!-- Modal de Conferência -->
        ${selectedLote ? `
          <div class="fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50 fade-in">
            <div class="w-full max-w-3xl bg-white rounded-2xl p-6 shadow-lg">
              <div class="flex items-start justify-between">
                <div>
                  <h3 class="text-xl font-semibold">Conferir Lote ${selectedLote.id}</h3>
                  <div class="text-sm text-slate-500">${selectedLote.produto} · Qtd: ${selectedLote.quantidade} · Data: ${selectedLote.data}</div>
                </div>
                <button onclick="closeConferencia()" class="text-slate-500">Fechar</button>
              </div>

              <div class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4">
                <div class="lg:col-span-2">
                  <div class="bg-slate-50 p-3 rounded-md">
                    <div class="font-medium mb-2">Checklist</div>
                    <div class="space-y-2">
                      ${checklist.map(item => `
                        <label class="flex items-center gap-3">
                          <input type="checkbox" ${item.ok ? 'checked' : ''} onchange="toggleChecklist('${item.key}')">
                          <span>${item.label}</span>
                        </label>
                      `).join('')}
                    </div>

                    <div class="mt-3">
                      <label class="block text-sm font-medium">Defeitos / Observações (opcional)</label>
                      <textarea oninput="handleDefeito(event)" rows="3" class="mt-1 w-full px-3 py-2 border rounded-md" placeholder="Descreva o problema...">${defeito}</textarea>
                    </div>

                    <div class="mt-3">
                      <label class="block text-sm font-medium">Foto evidência (opcional)</label>
                      <input type="file" accept="image/*" onchange="handleFoto(event)" class="mt-1 block w-full">
                      ${fotoUrl ? `<img src="${fotoUrl}" class="mt-2 w-40 h-28 object-cover rounded-md border">` : ''}
                    </div>

                    <div class="mt-4 flex gap-2">
                      <button onclick="salvarConferencia(true)" class="px-4 py-2 bg-green-600 text-white rounded-md">Salvar e Aprovar</button>
                      <button onclick="salvarConferencia(false)" class="px-4 py-2 bg-rose-600 text-white rounded-md">Salvar e Reprovar</button>
                      <button onclick="location.reload()" class="px-3 py-2 border rounded-md">Reset</button>
                    </div>
                  </div>
                </div>

                <aside class="p-3 border rounded-md bg-white">
                  <div class="font-medium mb-2">Painel Rápido</div>
                  <div class="text-sm text-slate-500">Conferente: ${currentUser.name}</div>
                  <div class="text-sm text-slate-500">Início: ${startTime ? new Date(startTime).toLocaleTimeString() : '-'}</div>
                  <div class="mt-3">
                    <div class="text-xs text-slate-500">Progresso checklist</div>
                    <div class="mt-2 bg-slate-100 h-3 rounded-md overflow-hidden">
                      <div class="h-3 bg-indigo-600" style="width: ${(checklist.filter(c => c.ok).length / checklist.length) * 100}%"></div>
                    </div>
                    <div class="text-xs text-slate-400 mt-1">${checklist.filter(c => c.ok).length}/${checklist.length} itens</div>
                  </div>
                </aside>
              </div>
            </div>
          </div>
        ` : ''}

        <footer class="mt-8 text-center text-xs text-slate-400">
          Protótipo em HTML + Tailwind. Funcionalidades simuladas.
        </footer>
      `;
    }

    // Inicializa
    window.onload = () => {
      document.body.innerHTML = `<div id="app"></div>`;
      render();
    };
  </script>
</body>
</html>